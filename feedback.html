<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="CommunityVoice Feedback Submission">
  <title>CommunityVoice</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Noto+Sans+Devanagari:wght@400;500;600;700&family=Noto+Sans+Kannada:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #E6E9EF, #F5F6F8);
      color: #333333;
      min-height: 100vh;
      overflow-x: hidden;
      position: relative;
    }

    /* Full-screen background with bubbles and wave effect */
    .background-wrapper {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      overflow: hidden;
      background: url('https://images.unsplash.com/photo-1516321497487-e288fb19713f?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.0.3') no-repeat center center/cover;
    }

    .background-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, rgba(0, 48, 135, 0.7), rgba(166, 25, 46, 0.5));
      z-index: 1;
    }

    /* Animated bubbles */
    .bubble {
      position: absolute;
      background: rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
      animation: float 10s infinite ease-in-out;
      z-index: 2;
    }

    .bubble:nth-child(1) { width: 50px; height: 50px; bottom: -50px; left: 10%; animation-duration: 12s; }
    .bubble:nth-child(2) { width: 70px; height: 70px; bottom: -70px; left: 20%; animation-duration: 15s; animation-delay: 2s; }
    .bubble:nth-child(3) { width: 40px; height: 40px; bottom: -40px; left: 30%; animation-duration: 10s; animation-delay: 4s; }
    .bubble:nth-child(4) { width: 60px; height: 60px; bottom: -60px; left: 50%; animation-duration: 14s; animation-delay: 1s; }
    .bubble:nth-child(5) { width: 80px; height: 80px; bottom: -80px; left: 70%; animation-duration: 13s; animation-delay: 3s; }
    .bubble:nth-child(6) { width: 30px; height: 30px; bottom: -30px; left: 90%; animation-duration: 11s; animation-delay: 5s; }

    @keyframes float {
      0% {
        transform: translateY(0) translateX(0);
        opacity: 0.8;
      }
      50% {
        transform: translateY(-100vh) translateX(20px);
        opacity: 0.5;
      }
      100% {
        transform: translateY(-200vh) translateX(-20px);
        opacity: 0;
      }
    }

    /* Wave effect at the bottom */
    .wave {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 150px;
      background: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxNDQwIDEwMCI+PHBhdGggZmlsbD0icmdiYSgyNTUsIDI1NSwgMjU1LCAwLjgpIiBmaWxsLW9wYWNpdHk9IjEiIGQ9Ik0wLDEwMEw0OCw4MCBDOTYsNjAsMTkyLDQwLDI4OCw0MCBDMzg0LDQwLDQ4MCw2MCw1NzYsODAgQzY3MiwxMDAsNzY4LDEwMCw4NjQsODAgQzk2MCw2MCwxMDU2LDQwLDExNTIsNDAgQzEyNDgsNDAsMTM0NCw2MCwxNDQwLDEwMFoiPjwvcGF0aD48L3N2Zz4=');
      background-size: cover;
      z-index: 3;
      animation: wave 20s infinite linear;
    }

    @keyframes wave {
      0% { background-position-x: 0; }
      100% { background-position-x: 1440px; }
    }

    html.lang-hi body,
    html.lang-hi input,
    html.lang-hi select,
    html.lang-hi textarea,
    html.lang-hi button {
      font-family: 'Noto Sans Devanagari', sans-serif;
    }

    html.lang-kn body,
    html.lang-kn input,
    html.lang-kn select,
    html.lang-kn textarea,
    html.lang-kn button {
      font-family: 'Noto Sans Kannada', sans-serif;
    }

    .language-switcher {
      position: absolute;
      top: 1rem;
      right: 1rem;
      z-index: 200;
    }

    .language-switcher select {
      padding: 0.5rem;
      background: rgba(255, 255, 255, 0.95);
      border: 1px solid rgba(0, 0, 0, 0.1);
      border-radius: 8px;
      color: #333333;
      font-family: 'Poppins', sans-serif;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .language-switcher select:focus {
      border-color: #003087;
      box-shadow: 0 0 4px rgba(0, 48, 135, 0.15);
      outline: 2px solid #003087;
    }

    .hero-section {
      text-align: center;
      padding: 3rem 1rem;
      animation: fadeIn 1s ease-in-out;
      position: relative;
      z-index: 5;
      color: #FFFFFF;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    .logo-container {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .logo-container i {
      font-size: 2rem;
      color: #FFFFFF;
      text-shadow: 0 0 8px rgba(255, 255, 255, 0.5);
    }

    .logo-container h1 {
      font-size: 2.5rem;
      color: #FFFFFF;
      text-shadow: 0 0 8px rgba(255, 255, 255, 0.5);
      font-weight: 700;
    }

    .logo-container h1 span {
      color: #A6192E;
      text-shadow: 0 0 8px rgba(166, 25, 46, 0.5);
    }

    .hero-subtitle {
      font-size: 1.2rem;
      color: #F9FAFB;
      font-weight: 500;
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
    }

    .main-container {
      display: flex;
      justify-content: center;
      padding: 2rem;
      animation: fadeIn 1s ease-in-out;
      position: relative;
      z-index: 5;
    }

    .feedback-card {
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(5px);
      border: 1px solid rgba(0, 0, 0, 0.1);
      border-radius: 10px;
      padding: 2rem;
      width: 100%;
      max-width: 600px;
      box-shadow: 0 0 8px rgba(0, 48, 135, 0.15);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
    }

    .card-header h2 {
      font-size: 1.5rem;
      color: #003087;
      text-shadow: 0 0 2px rgba(0, 48, 135, 0.2);
      font-weight: 700;
    }

    .card-header h2 i {
      margin-right: 0.5rem;
    }

    .status-indicator {
      width: 12px;
      height: 12px;
      background: #003087;
      border-radius: 50%;
      box-shadow: 0 0 4px rgba(0, 48, 135, 0.2);
    }

    .feedback-form {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    .form-group {
      position: relative;
    }

    .form-group.floating input,
    .form-group.floating select,
    .form-group textarea {
      width: 100%;
      padding: 0.8rem 1rem;
      background: rgba(255, 255, 255, 0.95);
      border: 1px solid rgba(0, 0, 0, 0.1);
      border-radius: 8px;
      color: #333333;
      font-size: 1rem;
      transition: all 0.3s ease;
      font-weight: 500;
    }

    .form-group.floating input:focus,
    .form-group.floating select:focus,
    .form-group textarea:focus {
      border-color: #003087;
      box-shadow: 0 0 4px rgba(0, 48, 135, 0.15);
      outline: 2px solid #003087;
    }

    .form-group.floating label {
      position: absolute;
      top: 50%;
      left: 1rem;
      transform: translateY(-50%);
      color: #4A5568;
      font-size: 0.9rem;
      pointer-events: none;
      transition: all 0.3s ease;
      font-weight: 500;
    }

    .form-group.floating input:not(:placeholder-shown)+label,
    .form-group.floating select:not(:placeholder-shown)+label,
    .form-group.floating input:focus+label,
    .form-group.floating select:focus+label,
    .form-group.floating textarea:not(:placeholder-shown)+label,
    .form-group.floating textarea:focus+label {
      top: 0;
      font-size: 0.75rem;
      color: #003087;
      text-shadow: 0 0 2px rgba(0, 48, 135, 0.2);
    }

    .form-group.floating .icon {
      margin-right: 0.5rem;
    }

    .form-group.floating select {
      appearance: none;
    }

    .form-group.floating .select-arrow {
      position: absolute;
      right: 1rem;
      top: 50%;
      transform: translateY(-50%);
      color: #003087;
      pointer-events: none;
    }

    .form-group textarea {
      min-height: 150px;
      resize: vertical;
    }

    .form-group textarea.lang-hi {
      font-family: 'Noto Sans Devanagari', sans-serif;
    }

    .form-group textarea.lang-kn {
      font-family: 'Noto Sans Kannada', sans-serif;
    }

    .location-group {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .locate-btn {
      background: none;
      border: 1px solid rgba(0, 0, 0, 0.1);
      border-radius: 8px;
      padding: 0.5rem 1rem;
      color: #003087;
      cursor: pointer;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      transition: all 0.3s ease;
      font-weight: 500;
    }

    .locate-btn:hover,
    .locate-btn.locating,
    .locate-btn:focus {
      border-color: #003087;
      box-shadow: 0 0 4px rgba(0, 48, 135, 0.15);
      background: rgba(0, 48, 135, 0.1);
      outline: 2px solid #003087;
    }

    .locate-btn.locating i {
      animation: spin 1s infinite linear;
    }

    .textarea-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 0.5rem;
    }

    .voice-btn {
      background: none;
      border: 1px solid rgba(0, 0, 0, 0.1);
      border-radius: 8px;
      padding: 0.5rem 1rem;
      color: #003087;
      cursor: pointer;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      transition: all 0.3s ease;
      font-weight: 500;
    }

    .voice-btn:hover,
    .voice-btn.recording,
    .voice-btn:focus {
      border-color: #003087;
      box-shadow: 0 0 4px rgba(0, 48, 135, 0.15);
      background: rgba(0, 48, 135, 0.1);
      outline: 2px solid #003087;
    }

    .voice-btn.recording i {
      color: #A6192E;
      text-shadow: 0 0 2px rgba(166, 25, 46, 0.2);
      animation: pulse 1s infinite;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); }
    }

    .char-count {
      font-size: 0.8rem;
      color: #4A5568;
      font-weight: 500;
    }

    .form-actions {
      text-align: center;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .submit-btn {
      background: rgba(0, 48, 135, 0.1);
      border: 1px solid #003087;
      border-radius: 8px;
      padding: 0.8rem 2rem;
      color: #003087;
      font-size: 1rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      transition: all 0.3s ease;
      font-weight: 600;
    }

    .submit-btn:hover,
    .submit-btn.sending,
    .submit-btn.success,
    .submit-btn:focus {
      background: rgba(0, 48, 135, 0.2);
      box-shadow: 0 0 8px rgba(0, 48, 135, 0.15);
      outline: 2px solid #003087;
    }

    .submit-btn.sending i {
      animation: spin 1s infinite linear;
    }

    .submit-btn.success i {
      color: #003087;
    }

    .logout-btn {
      background: rgba(166, 25, 46, 0.1);
      border: 1px solid #A6192E;
      border-radius: 8px;
      padding: 0.8rem 2rem;
      color: #A6192E;
      font-family: 'Poppins', sans-serif;
      font-size: 1rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      transition: all 0.3s ease;
      font-weight: 600;
    }

    .logout-btn:hover,
    .logout-btn:focus {
      background: rgba(166, 25, 46, 0.2);
      box-shadow: 0 0 8px rgba(166, 25, 46, 0.15);
      outline: 2px solid #A6192E;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .status-message {
      text-align: center;
      font-size: 0.9rem;
      margin-top: 1rem;
      opacity: 0;
      transition: opacity 0.3s ease;
      font-weight: 500;
    }

    .status-message.show {
      opacity: 1;
    }

    .status-message.info {
      color: #003087;
    }

    .status-message.success {
      color: #003087;
    }

    .status-message.error {
      color: #A6192E;
    }

    .card-footer {
      text-align: center;
      margin-top: 2rem;
      font-size: 0.8rem;
      color: #4A5568;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      font-weight: 500;
    }

    .card-footer i {
      color: #003087;
    }

    .popup-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
      z-index: 100;
    }

    .popup-overlay.visible {
      opacity: 1;
      pointer-events: auto;
    }

    .popup-content {
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(5px);
      border: 1px solid rgba(0, 0, 0, 0.1);
      border-radius: 10px;
      padding: 2rem;
      text-align: center;
      max-width: 400px;
      width: 90%;
    }

    .popup-content i {
      font-size: 3rem;
      margin-bottom: 1rem;
    }

    .popup-content .fa-check-circle {
      color: #003087;
      text-shadow: 0 0 3px rgba(0, 48, 135, 0.2);
    }

    .popup-content .fa-exclamation-circle {
      color: #A6192E;
      text-shadow: 0 0 3px rgba(166, 25, 46, 0.2);
    }

    .popup-content h3 {
      font-size: 1.5rem;
      color: #003087;
      text-shadow: 0 0 2px rgba(0, 48, 135, 0.2);
      margin-bottom: 1rem;
      font-weight: 700;
    }

    .popup-content p {
      font-size: 1rem;
      color: #4A5568;
      margin-bottom: 1.5rem;
      font-weight: 500;
    }

    .popup-close-btn {
      background: rgba(0, 48, 135, 0.1);
      border: 1px solid #003087;
      border-radius: 8px;
      padding: 0.5rem 1.5rem;
      color: #003087;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 600;
    }

    .popup-close-btn:hover,
    .popup-close-btn:focus {
      background: rgba(0, 48, 135, 0.2);
      box-shadow: 0 0 8px rgba(0, 48, 135, 0.15);
      outline: 2px solid #003087;
    }

    @media (max-width: 768px) {
      .hero-section {
        padding: 2rem 1rem;
      }

      .logo-container h1 {
        font-size: 2rem;
      }

      .hero-subtitle {
        font-size: 1rem;
      }

      .main-container {
        padding: 1rem;
      }

      .feedback-card {
        padding: 1.5rem;
      }

      .language-switcher {
        top: 0.5rem;
        right: 0.5rem;
      }

      .location-group {
        flex-direction: column;
        align-items: stretch;
      }

      .locate-btn {
        width: 100%;
        justify-content: center;
      }
    }

    @media (max-width: 480px) {
      .logo-container h1 {
        font-size: 1.8rem;
      }

      .hero-subtitle {
        font-size: 0.9rem;
      }

      .feedback-card {
        padding: 1rem;
      }

      .card-header h2 {
        font-size: 1.2rem;
      }

      .form-group.floating input,
      .form-group.floating select,
      .form-group textarea {
        font-size: 0.9rem;
      }

      .submit-btn,
      .logout-btn {
        padding: 0.6rem 1.5rem;
        font-size: 0.9rem;
      }

      .language-switcher select {
        font-size: 0.8rem;
        padding: 0.4rem;
      }
    }
  </style>
</head>
<body>
  <!-- Background with bubbles and wave -->
  <div class="background-wrapper">
    <div class="background-overlay"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="wave"></div>
  </div>

  <div class="language-switcher">
    <select id="language-switcher" aria-label="Select Interface Language">
      <option value="en">English</option>
      <option value="hi">हिन्दी</option>
      <option value="kn">ಕನ್ನಡ</option>
    </select>
  </div>

  <header class="hero-section" aria-label="CommunityVoice Header">
    <div class="logo-container">
      <i class="fas fa-users" aria-hidden="true"></i>
      <h1 data-translate="title">Community<span>Voice</span></h1>
    </div>
    <p class="hero-subtitle" data-translate="subtitle">Your feedback shapes our community's future</p>
  </header>

  <main class="main-container">
    <div class="feedback-card" aria-label="Feedback Submission Form">
      <div class="card-header">
        <h2><i class="fas fa-comment-alt" aria-hidden="true"></i> <span data-translate="form_title">Submit Feedback</span></h2>
        <span class="status-indicator" aria-hidden="true"></span>
      </div>

      <form id="feedback-form" class="feedback-form">
        <div class="form-group floating">
          <input type="text" id="name" placeholder=" " required aria-label="Full Name">
          <label for="name"><i class="fas fa-user icon" aria-hidden="true"></i> <span data-translate="name_label">Full Name</span></label>
        </div>

        <div class="form-group floating location-group">
          <div style="flex-grow: 1;">
            <input type="text" id="location" placeholder=" " required aria-label="Location or Address">
            <label for="location"><i class="fas fa-map-marker-alt icon" aria-hidden="true"></i> <span data-translate="location_label">Location/Address</span></label>
          </div>
          <button type="button" class="locate-btn" id="locate-btn" aria-label="Locate Me">
            <i class="fas fa-location-arrow" aria-hidden="true"></i> <span data-translate="locate_btn">Locate Me</span>
          </button>
        </div>

        <div class="form-group floating">
          <select id="language" required aria-label="Feedback Language">
            <option value="" disabled selected></option>
            <option value="English">English</option>
            <option value="Hindi">Hindi</option>
            <option value="Kannada">Kannada</option>
            <option value="Tamil">Tamil</option>
            <option value="Telugu">Telugu</option>
            <option value="Bengali">Bengali</option>
            <option value="Gujarati">Gujarati</option>
            <option value="Malayalam">Malayalam</option>
            <option value="Marathi">Marathi</option>
            <option value="Punjabi">Punjabi</option>
            <option value="Odia">Odia</option>
            <option value="Assamese">Assamese</option>
          </select>
          <label for="language"><i class="fas fa-globe icon" aria-hidden="true"></i> <span data-translate="language_label">Feedback Language</span></label>
          <i class="fas fa-chevron-down select-arrow" aria-hidden="true"></i>
        </div>

        <div class="form-group floating">
          <select id="category" required aria-label="Category">
            <option value="" disabled selected></option>
            <option value="Water Supply" data-translate="category_water">Water Supply</option>
            <option value="Roads & Infrastructure" data-translate="category_roads">Roads & Infrastructure</option>
            <option value="Power Supply" data-translate="category_power">Power Supply</option>
            <option value="Community Safety" data-translate="category_safety">Community Safety</option>
            <option value="Transportation" data-translate="category_transport">Transportation</option>
            <option value="Other" data-translate="category_other">Other Concerns</option>
          </select>
          <label for="category"><i class="fas fa-list icon" aria-hidden="true"></i> <span data-translate="category_label">Category</span></label>
          <i class="fas fa-chevron-down select-arrow" aria-hidden="true"></i>
        </div>

        <div class="form-group floating" id="other-category-container" style="display: none;">
          <input type="text" id="other-category" placeholder=" " aria-label="Specify Concern">
          <label for="other-category"><i class="fas fa-pen icon" aria-hidden="true"></i> <span data-translate="other_category_label">Specify Concern</span></label>
        </div>

        <div class="form-group">
          <textarea id="feedback" placeholder="Share your feedback here..." maxlength="500" required aria-label="Feedback" data-translate-placeholder="feedback_placeholder"></textarea>
          <div class="textarea-footer">
            <button type="button" class="voice-btn" id="voice-btn" aria-label="Voice Input">
              <i class="fas fa-microphone" aria-hidden="true"></i> <span id="voice-btn-text " data-translate="voice_btn">Voice Input</span>
            </button>
            <span class="char-count" id="char-remaining" data-translate="char_remaining">500 characters remaining</span>
          </div>
        </div>

        <div class="form-actions">
          <button type="submit" class="submit-btn" aria-label="Submit Feedback">
            <span data-translate="submit_btn">Submit Feedback</span>
            <i class="fas fa-paper-plane" aria-hidden="true"></i>
          </button>
          <button type="button" class="logout-btn" id="logout-btn" aria-label="Log Out">
            <span data-translate="logout_btn">Log Out</span>
            <i class="fas fa-sign-out-alt" aria-hidden="true"></i>
          </button>
        </div>

        <div class="status-message" id="status-msg" role="status" aria-live="polite"></div>
      </form>

      <div class="card-footer">
        <i class="fas fa-lock" aria-hidden="true"></i>
        <span data-translate="footer">Your information is secure and will only be used for community improvement purposes.</span>
      </div>
    </div>
  </main>

  <div class="popup-overlay" id="success-popup" role="dialog" aria-labelledby="success-popup-title" aria-hidden="true">
    <div class="popup-content">
      <i class="fas fa-check-circle" aria-hidden="true"></i>
      <h3 id="success-popup-title" data-translate="success_title">Thank You!</h3>
      <p id="success-popup-message" data-translate="success_message">Your feedback has been submitted successfully. We appreciate your contribution to our community.</p>
      <button class="popup-close-btn" onclick="closePopup('success-popup')" aria-label="Close" data-translate="close_btn">Close</button>
    </div>
  </div>

  <div class="popup-overlay" id="error-popup" role="dialog" aria-labelledby="error-popup-title" aria-hidden="true">
    <div class="popup-content">
      <i class="fas fa-exclamation-circle" aria-hidden="true"></i>
      <h3 id="error-popup-title" data-translate="error_title">Oops!</h3>
      <p id="error-popup-message"></p>
      <button class="popup-close-btn" onclick="closePopup('error-popup')" aria-label="Close" data-translate="close_btn">Close</button>
    </div>
  </div>

  <script>
    // Translation object for UI (English, Hindi, Kannada only)
    const translations = {
      en: {
        title: 'CommunityVoice',
        subtitle: "Your feedback shapes our community's future",
        form_title: 'Submit Feedback',
        name_label: 'Full Name',
        location_label: 'Location/Address',
        language_label: 'Feedback Language',
        category_label: 'Category',
        category_water: 'Water Supply',
        category_roads: 'Roads & Infrastructure',
        category_power: 'Power Supply',
        category_safety: 'Community Safety',
        category_transport: 'Transportation',
        category_other: 'Other Concerns',
        other_category_label: 'Specify Concern',
        feedback_placeholder: 'Share your feedback here...',
        voice_btn: 'Voice Input',
        stop_voice_btn: 'Stop Recording',
        locate_btn: 'Locate Me',
        char_remaining: '500 characters remaining',
        submit_btn: 'Submit Feedback',
        logout_btn: 'Log Out',
        footer: 'Your information is secure and will only be used for community improvement purposes.',
        success_title: 'Thank You!',
        success_message: 'Your feedback has been submitted successfully. We appreciate your contribution to our community.',
        error_title: 'Oops!',
        error_server_down: 'Server is not responding. Please check if the server is running and try again.',
        error_invalid_data: 'Invalid data submitted. Please check your input and try again.',
        error_network: 'Network error occurred. Please check your connection and try again.',
        error_unknown: 'An unexpected error occurred. Please try again later.',
        close_btn: 'Close',
        status_listening: 'Listening... Please speak clearly.',
        status_stopped: 'Voice input stopped.',
        status_voice_error: 'Voice input failed. Please try again.',
        status_voice_unsupported: 'Voice input is not supported in this browser. Please use Chrome or Edge.',
        status_script_mismatch: 'Transcribed text is not valid for the selected language. Please try again or type manually.',
        status_submitting: 'Submitting feedback...',
        status_locating: 'Detecting location...',
        status_location_denied: 'Location access denied. Please enter your address manually.',
        status_location_error: 'Unable to detect location. Please enter your address manually.',
        status_location_unsupported: 'Geolocation is not supported in this browser. Please use Chrome or Edge.',
        status_reverse_geocode_error: 'Unable to convert coordinates to address. Please enter manually.'
      },
      hi: {
        title: 'सामुदायिक आवाज',
        subtitle: 'आपकी प्रतिक्रिया हमारे समुदाय के भविष्य को आकार देती है',
        form_title: 'प्रतिक्रिया सबमिट करें',
        name_label: 'पूरा नाम',
        location_label: 'स्थान/पता',
        language_label: 'प्रतिक्रिया की भाषा',
        category_label: 'श्रेणी',
        category_water: 'जल आपूर्ति',
        category_roads: 'सड़कें और बुनियादी ढांचा',
        category_power: 'विद्युत आपूर्ति',
        category_safety: 'सामुदायिक सुरक्षा',
        category_transport: 'परिवहन',
        category_other: 'अन्य चिंताएँ',
        other_category_label: 'चिंता निर्दिष्ट करें',
        feedback_placeholder: 'यहाँ अपनी प्रतिक्रिया साझा करें...',
        voice_btn: 'आवाज इनपुट',
        stop_voice_btn: 'रिकॉर्डिंग बंद करें',
        locate_btn: 'मुझे ढूंढें',
        char_remaining: '500 अक्षर शेष',
        submit_btn: 'प्रतिक्रिया सबमिट करें',
        logout_btn: 'लॉग आउट',
        footer: 'आपकी जानकारी सुरक्षित है और केवल सामुदायिक सुधार के उद्देश्यों के लिए उपयोग की जाएगी।',
        success_title: 'धन्यवाद!',
        success_message: 'आपकी प्रतिक्रिया सफलतापूर्वक सबमिट कर दी गई है। हम आपके योगदान की सराहना करते हैं।',
        error_title: 'ओह!',
        error_server_down: 'सर्वर प्रतिक्रिया नहीं दे रहा है। कृपया जांचें कि सर्वर चल रहा है और पुनः प्रयास करें।',
        error_invalid_data: 'अमान्य डेटा सबमिट किया गया। कृपया अपनी इनपुट जांचें और पुनः प्रयास करें।',
        error_network: 'नेटवर्क त्रुटि हुई। कृपया अपनी कनेक्शन जांचें और पुनः प्रयास करें।',
        error_unknown: 'एक अप्रत्याशित त्रुटि हुई। कृपया बाद में पुनः प्रयास करें।',
        close_btn: 'बंद करें',
        status_listening: 'सुन रहा है... कृपया स्पष्ट रूप से बोलें।',
        status_stopped: 'आवाज इनपुट बंद कर दिया गया।',
        status_voice_error: 'आवाज इनपुट विफल। कृपया पुनः प्रयास करें।',
        status_voice_unsupported: 'इस ब्राउज़र में आवाज इनपुट समर्थित नहीं है। कृपया Chrome या Edge का उपयोग करें।',
        status_script_mismatch: 'लिखित पाठ चयनित भाषा के लिए मान्य नहीं है। कृपया पुनः प्रयास करें या मैन्युअल रूप से टाइप करें।',
        status_submitting: 'प्रतिक्रिया सबमिट कर रहा है...',
        status_locating: 'स्थान का पता लगाया जा रहा है...',
        status_location_denied: 'स्थान तक पहुंच अस्वीकृत। कृपया अपना पता मैन्युअल रूप से दर्ज करें।',
        status_location_error: 'स्थान का पता लगाने में असमर्थ। कृपया अपना पता मैन्युअल रूप से दर्ज करें।',
        status_location_unsupported: 'इस ब्राउज़र में जियोलोकेशन समर्थित नहीं है। कृपया Chrome या Edge का उपयोग करें।',
        status_reverse_geocode_error: 'निर्देशांक को पते में बदलने में असमर्थ। कृपया मैन्युअल रूप से दर्ज करें।'
      },
      kn: {
        title: 'ಸಮುದಾಯದ ಧ್ವನಿ',
        subtitle: 'ನಿಮ್ಮ ಪ್ರತಿಕ್ರಿಯೆ ನಮ್ಮ ಸಮುದಾಯದ ಭವಿಷ್ಯವನ್ನು ರೂಪಿಸುತ್ತದೆ',
        form_title: 'ಪ್ರತಿಕ್ರಿಯೆ ಸಲ್ಲಿಸಿ',
        name_label: 'ಪೂರ್ಣ ಹೆಸರು',
        location_label: 'ಸ್ಥಳ/ವಿಳಾಸ',
        language_label: 'ಪ್ರತಿಕ್ರಿಯೆಯ ಭಾಷೆ',
        category_label: 'ವರ್ಗ',
        category_water: 'ನೀರಿನ ಸರಬರಾಜು',
        category_roads: 'ರಸ್ತೆಗಳು ಮತ್ತು ಮೂಲಸೌಕರ್ಯ',
        category_power: 'ವಿದ್ಯುತ್ ಸರಬರಾಜು',
        category_safety: 'ಸಮುದಾಯದ ಸುರಕ್ಷತೆ',
        category_transport: 'ಸಾರಿಗೆ',
        category_other: 'ಇತರ ಕಾಳಜಿಗಳು',
        other_category_label: 'ಕಾಳಜಿಯನ್ನು ಸೂಚಿಸಿ',
        feedback_placeholder: 'ನಿಮ್ಮ ಪ್ರತಿಕ್ರಿಯೆಯನ್ನು ಇಲ್ಲಿ ಹಂಚಿಕೊಳ್ಳಿ...',
        voice_btn: 'ಧ್ವನಿ ಇನ್‌ಪುಟ್',
        stop_voice_btn: 'ರೆಕಾರ್ಡಿಂಗ್ ನಿಲ್ಲಿಸಿ',
        locate_btn: 'ನನ್ನನ್ನು ಕಂಡುಹಿಡಿ',
        char_remaining: '500 ಅಕ್ಷರಗಳು ಉಳಿದಿವೆ',
        submit_btn: 'ಪ್ರತಿಕ್ರಿಯೆ ಸಲ್ಲಿಸಿ',
        logout_btn: 'ಲಾಗ್ ಔಟ್',
        footer: 'ನಿಮ್ಮ ಮಾಹಿತಿಯು ಸುರಕ್ಷಿತವಾಗಿದೆ ಮತ್ತು ಕೇವಲ ಸಮುದಾಯ ಸುಧಾರಣೆಯ ಉದ್ದೇಶಗಳಿಗೆ ಮಾತ್ರ ಬಳಸಲಾಗುತ್ತದೆ.',
        success_title: 'ಧನ್ಯವಾದಗಳು!',
        success_message: 'ನಿಮ್ಮ ಪ್ರತಿಕ್ರಿಯೆಯನ್ನು ಯಶಸ್ವಿಯಾಗಿ ಸಲ್ಲಿಸಲಾಗಿದೆ. ನಿಮ್ಮ ಕೊಡುಗೆಯನ್ನು ನಾವು ಪ್ರಶಂಸಿಸುತ್ತೇವೆ.',
        error_title: 'ಓಹ್!',
        error_server_down: 'ಸರ್ವರ್ ಪ್ರತಿಕ್ರಿಯೆ ನೀಡುತ್ತಿಲ್ಲ. ದಯವಿಟ್ಟು ಸರ್ವರ್ ಚಾಲನೆಯಲ್ಲಿದೆಯೇ ಎಂದು ಪರಿಶೀಲಿಸಿ ಮತ್ತು ಮತ್ತೆ ಪ್ರಯತ್ನಿಸಿ.',
        error_invalid_data: 'ಅಮಾನ್ಯ ಡೇಟಾವನ್ನು ಸಲ್ಲಿಸಲಾಗಿದೆ. ದಯವಿಟ್ಟು ನಿಮ್ಮ ಒಳಸೇರಿಕೆಯನ್ನು ಪರಿಶೀಲಿಸಿ ಮತ್ತು ಮತ್ತೆ ಪ್ರಯತ್ನಿಸಿ.',
        error_network: 'ನೆಟ್‌ವರ್ಕ್ ದೋಷ ಸಂಭವಿಸಿದೆ. ದಯವಿಟ್ಟು ನಿಮ್ಮ ಸಂಪರ್ಕವನ್ನು ಪರಿಶೀಲಿಸಿ ಮತ್ತು ಮತ್ತೆ ಪ್ರಯತ್ನಿಸಿ.',
        error_unknown: 'ಅನಿರೀಕ್ಷಿತ ದೋಷ ಸಂಭವಿಸಿದೆ. ದಯವಿಟ್ಟು ನಂತರ ಮತ್ತೆ ಪ್ರಯತ್ನಿಸಿ.',
        close_btn: 'ಮುಚ್ಚಿ',
        status_listening: 'ಕೇಳುತ್ತಿದೆ... ದಯವಿಟ್ಟು ಸ್ಪಷ್ಟವಾಗಿ ಮಾತನಾಡಿ.',
        status_stopped: 'ಧ್ವನಿ ಇನ್‌ಪುಟ್ ನಿಲ್ಲಿಸಲಾಗಿದೆ.',
        status_voice_error: 'ಧ್ವನಿ ಇನ್‌ಪುಟ್ ವಿಫಲವಾಗಿದೆ. ದಯವಿಟ್ಟು ಮತ್ತೆ ಪ್ರಯತ್ನಿಸಿ.',
        status_voice_unsupported: 'ಈ ಬ್ರೌಸರ್‌ನಲ್ಲಿ ಧ್ವನಿ ಇನ್‌ಪುಟ್ ಬೆಂಬಲಿತವಾಗಿಲ್ಲ. ದಯವಿಟ್ಟು Chrome ಅಥವಾ Edge ಬಳಸಿ.',
        status_script_mismatch: 'ಲಿಖಿತ ಪಠ್ಯ ಆಯ್ಕೆಮಾಡಿದ ಭಾಷೆಗೆ ಮಾನ್ಯವಾಗಿಲ್ಲ. ದಯವಿಟ್ಟು ಮತ್ತೆ ಪ್ರಯತ್ನಿಸಿ ಅಥವಾ ಕೈಯಾರೆ ಟೈಪ್ ಮಾಡಿ.',
        status_submitting: 'ಪ್ರತಿಕ್ರಿಯೆ ಸಲ್ಲಿಸುತ್ತಿದೆ...',
        status_locating: 'ಸ್ಥಳವನ್ನು ಕಂಡುಹಿಡಿಯಲಾಗುತ್ತಿದೆ...',
        status_location_denied: 'ಸ್ಥಳದ ಪ್ರವೇಶವನ್ನು ನಿರಾಕರಿಸಲಾಗಿದೆ. ದಯವಿಟ್ಟು ನಿಮ್ಮ ವಿಳಾಸವನ್ನು ಕೈಯಾರೆ ಭರ್ತಿ ಮಾಡಿ.',
        status_location_error: 'ಸ್ಥಳವನ್ನು ಕಂಡುಹಿಡಿಯಲು ಸಾಧ್ಯವಾಗಲಿಲ್ಲ. ದಯವಿಟ್ಟು ನಿಮ್ಮ ವಿಳಾಸವನ್ನು ಕೈಯಾರೆ ಭರ್ತಿ ಮಾಡಿ.',
        status_location_unsupported: 'ಈ ಬ್ರೌಸರ್‌ನಲ್ಲಿ ಜಿಯೋಲೊಕೇಶನ್ ಬೆಂಬಲಿತವಾಗಿಲ್ಲ. ದಯವಿಟ್ಟು Chrome ಅಥವಾ Edge ಬಳಸಿ.',
        status_reverse_geocode_error: 'ನಿರ್ದೇಶಾಂಕಗಳನ್ನು ವಿಳಾಸಕ್ಕೆ ಪರಿವರ್ತಿಸಲು ಸಾಧ್ಯವಾಗಲಿಲ್ಲ. ದಯವಿಟ್ಟು ಕೈಯಾರೆ ಭರ್ತಿ ಮಾಡಿ.'
      }
    };

    // Initialize elements
    const languageSwitcher = document.getElementById('language-switcher');
    const html = document.documentElement;
    const formLanguageSelect = document.getElementById('language');
    const statusMsg = document.getElementById('status-msg');
    const voiceBtn = document.getElementById('voice-btn');
    const feedbackTextarea = document.getElementById('feedback');
    const charRemaining = document.getElementById('char-remaining');
    const errorPopupMessage = document.getElementById('error-popup-message');

    // Load saved UI language or default to English
    const savedUILanguage = localStorage.getItem('uiLanguage') || 'en';
    languageSwitcher.value = savedUILanguage;
    html.setAttribute('lang', savedUILanguage);
    html.classList.add(`lang-${savedUILanguage}`);

    // Check browser compatibility
    const isSpeechSupported = 'SpeechRecognition' in window || 'webkitSpeechRecognition' in window;
    const isGeolocationSupported = 'geolocation' in navigator;

    if (!isSpeechSupported) {
      voiceBtn.disabled = true;
      voiceBtn.title = translations[savedUILanguage].status_voice_unsupported;
    }

    // Translate page based on UI language
    function translatePage(lang) {
      document.querySelectorAll('[data-translate]').forEach(element => {
        const key = element.getAttribute('data-translate');
        if (translations[lang][key]) {
          element.textContent = translations[lang][key];
        }
      });

      document.querySelectorAll('[data-translate-placeholder]').forEach(element => {
        const key = element.getAttribute('data-translate-placeholder');
        if (translations[lang][key]) {
          element.placeholder = translations[lang][key];
        }
      });

      document.querySelectorAll('#category option[data-translate]').forEach(option => {
        const key = option.getAttribute('data-translate');
        if (translations[lang][key]) {
          option.textContent = translations[lang][key];
        }
      });

      const remaining = 500 - (feedbackTextarea.value.length || 0);
      charRemaining.textContent = translations[lang].char_remaining.replace('500', remaining);

      // Update textarea font based on UI language
      feedbackTextarea.classList.remove('lang-en', 'lang-hi', 'lang-kn');
      feedbackTextarea.classList.add(`lang-${lang}`);
    }

    // Initial translation
    translatePage(savedUILanguage);

    // UI language change handler
    languageSwitcher.addEventListener('change', () => {
      const newLang = languageSwitcher.value;
      localStorage.setItem('uiLanguage', newLang);
      html.setAttribute('lang', newLang);
      html.classList.remove('lang-en', 'lang-hi', 'lang-kn');
      html.classList.add(`lang-${newLang}`);
      translatePage(newLang);
      statusMsg.textContent = `Interface language changed to ${translations[newLang].language_label}`;
      statusMsg.classList.add('show', 'info');
      setTimeout(() => statusMsg.classList.remove('show', 'info'), 3000);
    });

    // Character count
    feedbackTextarea.addEventListener('input', () => {
      const remaining = 500 - feedbackTextarea.value.length;
      const lang = languageSwitcher.value;
      charRemaining.textContent = translations[lang].char_remaining.replace('500', remaining);
    });

    // Show/hide other category input
    const categorySelect = document.getElementById('category');
    const otherCategoryContainer = document.getElementById('other-category-container');
    const otherCategoryInput = document.getElementById('other-category');

    categorySelect.addEventListener('change', () => {
      if (categorySelect.value === 'Other') {
        otherCategoryContainer.style.display = 'block';
        otherCategoryInput.setAttribute('required', '');
      } else {
        otherCategoryContainer.style.display = 'none';
        otherCategoryInput.removeAttribute('required');
      }
    });

    // Reverse geocoding using Nominatim
    async function reverseGeocode(lat, lon) {
      const lang = languageSwitcher.value;
      try {
        const response = await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lon}&format=json&addressdetails=1`);
        const data = await response.json();
        if (data && data.display_name) {
          return data.display_name;
        } else {
          throw new Error('No address found');
        }
      } catch (error) {
        console.error('Reverse geocode error:', error);
        showStatus(translations[lang].status_reverse_geocode_error, 'error');
        return null;
      }
    }

    // Geolocation
    const locateBtn = document.getElementById('locate-btn');
    const locationInput = document.getElementById('location');

    locateBtn.addEventListener('click', () => {
      const lang = languageSwitcher.value;
      if (!isGeolocationSupported) {
        showStatus(translations[lang].status_location_unsupported, 'error');
        return;
      }

      locateBtn.classList.add('locating');
      locateBtn.disabled = true;
      showStatus(translations[lang].status_locating, 'info');

      navigator.geolocation.getCurrentPosition(
        async (position) => {
          const { latitude, longitude } = position.coords;
          const address = await reverseGeocode(latitude, longitude);
          if (address) {
            locationInput.value = address;
            showStatus('Location detected successfully', 'success');
          } else {
            locationInput.value = '';
            showStatus(translations[lang].status_reverse_geocode_error, 'error');
          }
          locateBtn.classList.remove('locating');
          locateBtn.disabled = false;
        },
        (error) => {
          console.error('Geolocation error:', error);
          locateBtn.classList.remove('locating');
          locateBtn.disabled = false;
          if (error.code === error.PERMISSION_DENIED) {
            showStatus(translations[lang].status_location_denied, 'error');
          } else {
            showStatus(translations[lang].status_location_error, 'error');
          }
        }
      );
    });

    // Voice input
    let recognition = null;
    let isRecording = false;
    const voiceBtnText = document.getElementById('voice-btn-text');

    voiceBtn.addEventListener('click', () => {
      const uiLang = languageSwitcher.value;
      const feedbackLang = formLanguageSelect.value;
      if (!feedbackLang) {
        showStatus('Please select a feedback language', 'error');
        return;
      }

      const langCodeMap = {
        'English': 'en-IN',
        'Hindi': 'hi-IN',
        'Kannada': 'kn-IN',
        'Tamil': 'ta-IN',
        'Telugu': 'te-IN',
        'Bengali': 'bn-IN',
        'Gujarati': 'gu-IN',
        'Malayalam': 'ml-IN',
        'Marathi': 'mr-IN',
        'Punjabi': 'pa-IN',
        'Odia': 'or-IN',
        'Assamese': 'as-IN'
      };
      const langCode = langCodeMap[feedbackLang] || 'en-IN';

      if (!isSpeechSupported) {
        showStatus(translations[uiLang].status_voice_unsupported, 'error');
        return;
      }

      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

      if (!isRecording) {
        recognition = new SpeechRecognition();
        recognition.lang = langCode;
        recognition.interimResults = false;
        recognition.continuous = false;

        recognition.onresult = (event) => {
          const transcript = event.results[0][0].transcript;
          if (!isValidText(transcript, feedbackLang)) {
            showStatus(translations[uiLang].status_script_mismatch, 'error');
            return;
          }

          const currentText = feedbackTextarea.value;
          const newText = currentText ? `${currentText} ${transcript}` : transcript;
          if (newText.length <= 500) {
            feedbackTextarea.value = newText;
            const remaining = 500 - feedbackTextarea.value.length;
            charRemaining.textContent = translations[uiLang].char_remaining.replace('500', remaining);
          } else {
            showStatus('Feedback must be 500 characters or less', 'error');
          }
        };

        recognition.onerror = (event) => {
          console.error('Voice recognition error:', event.error);
          showStatus(translations[uiLang].status_voice_error, 'error');
          isRecording = false;
          voiceBtn.classList.remove('recording');
          voiceBtnText.textContent = translations[uiLang].voice_btn;
        };

        recognition.onend = () => {
          isRecording = false;
          voiceBtn.classList.remove('recording');
          voiceBtnText.textContent = translations[uiLang].voice_btn;
          showStatus(translations[uiLang].status_stopped, 'info');
        };

        try {
          recognition.start();
          isRecording = true;
          voiceBtn.classList.add('recording');
          voiceBtnText.textContent = translations[uiLang].stop_voice_btn;
          showStatus(translations[uiLang].status_listening, 'info');
        } catch (error) {
          console.error('Voice recognition start error:', error);
          showStatus(translations[uiLang].status_voice_error, 'error');
        }
      } else {
        recognition.stop();
        isRecording = false;
        voiceBtn.classList.remove('recording');
        voiceBtnText.textContent = translations[uiLang].voice_btn;
        showStatus(translations[uiLang].status_stopped, 'info');
      }
    });

    // Text validation for feedback language
    function isValidText(text, feedbackLang) {
      const scripts = {
        'English': /^[A-Za-z0-9\s.,!?]+$/,
        'Hindi': /^[\u0900-\u097F\s.,!?]+$/,
        'Kannada': /^[\u0C80-\u0CFF\s.,!?]+$/,
        'Tamil': /^[\u0B80-\u0BFF\s.,!?]+$/,
        'Telugu': /^[\u0C00-\u0C7F\s.,!?]+$/,
        'Bengali': /^[\u0980-\u09FF\s.,!?]+$/,
        'Gujarati': /^[\u0A80-\u0AFF\s.,!?]+$/,
        'Malayalam': /^[\u0D00-\u0D7F\s.,!?]+$/,
        'Marathi': /^[\u0900-\u097F\s.,!?]+$/,
        'Punjabi': /^[\u0A00-\u0A7F\s.,!?]+$/,
        'Odia': /^[\u0B00-\u0B7F\s.,!?]+$/,
        'Assamese': /^[\u0980-\u09FF\s.,!?]+$/
      };
      return scripts[feedbackLang] ? scripts[feedbackLang].test(text) : true;
    }

    // Status message
    function showStatus(message, type) {
      statusMsg.textContent = message;
      statusMsg.classList.remove('info', 'success', 'error');
      statusMsg.classList.add('show', type);
      setTimeout(() => statusMsg.classList.remove('show', type), 3000);
    }

    // Popup handling
    function closePopup(popupId) {
      const popup = document.getElementById(popupId);
      popup.classList.remove('visible');
      popup.setAttribute('aria-hidden', 'true');
      document.querySelector('.submit-btn').focus();
    }

    // Form submission with retry
    const feedbackForm = document.getElementById('feedback-form');
    const submitBtn = document.querySelector('.submit-btn');

    async function submitFeedback(formData, retries = 2) {
      try {
        const response = await fetch('http://localhost:5000/api/v1/feedback', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(formData)
        });

        if (response.ok) {
          return { success: true };
        } else {
          const errorData = await response.json().catch(() => ({}));
          console.error('Submission failed:', response.status, errorData);
          return { success: false, status: response.status, message: errorData.message || 'Invalid data' };
        }
      } catch (error) {
        console.error('Submission error:', error);
        return { success: false, error: error.message };
      }
    }

    feedbackForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const uiLang = languageSwitcher.value;
      submitBtn.classList.add('sending');
      submitBtn.disabled = true;
      showStatus(translations[uiLang].status_submitting, 'info');

      const formData = {
        fullName: document.getElementById('name').value.trim(),
        location: document.getElementById('location').value.trim(),
        language: document.getElementById('language').value,
        category: document.getElementById('category').value,
        otherCategory: document.getElementById('other-category').value.trim() || '',
        feedback: document.getElementById('feedback').value.trim()
      };

      if (formData.feedback.length > 500) {
        showStatus('Feedback must be 500 characters or less', 'error');
        errorPopupMessage.textContent = 'Feedback must be 500 characters or less';
        const errorPopup = document.getElementById('error-popup');
        errorPopup.classList.add('visible');
        errorPopup.setAttribute('aria-hidden', 'false');
        document.querySelector('#error-popup .popup-close-btn').focus();
        submitBtn.classList.remove('sending');
        submitBtn.disabled = false;
        return;
      }

      let attempt = 0;
      const maxRetries = 2;

      while (attempt <= maxRetries) {
        const result = await submitFeedback(formData);
        console.log(`Submission attempt ${attempt + 1}:`, result);

        if (result.success) {
          const successPopup = document.getElementById('success-popup');
          successPopup.classList.add('visible');
          successPopup.setAttribute('aria-hidden', 'false');
          document.querySelector('#success-popup .popup-close-btn').focus();
          feedbackForm.reset();
          otherCategoryContainer.style.display = 'none';
          charRemaining.textContent = translations[uiLang].char_remaining;
          showStatus(translations[uiLang].success_message, 'success');
          submitBtn.classList.remove('sending');
          submitBtn.disabled = false;
          return;
        } else {
          let errorKey = 'error_unknown';
          if (!navigator.onLine) {
            errorKey = 'error_network';
          } else if (result.status === 400 || result.status === 422) {
            errorKey = 'error_invalid_data';
          } else if (result.status >= 500 || result.error) {
            errorKey = 'error_server_down';
          }

          if (attempt < maxRetries) {
            console.log(`Retrying submission... Attempt ${attempt + 2}`);
            attempt++;
            await new Promise(resolve => setTimeout(resolve, 1000)); // Wait 1s before retry
            continue;
          }

          errorPopupMessage.textContent = translations[uiLang][errorKey];
          const errorPopup = document.getElementById('error-popup');
          errorPopup.classList.add('visible');
          errorPopup.setAttribute('aria-hidden', 'false');
          document.querySelector('#error-popup .popup-close-btn').focus();
          showStatus(translations[uiLang][errorKey], 'error');
          submitBtn.classList.remove('sending');
          submitBtn.disabled = false;
          return;
        }
      }
    });

    // Logout
    const logoutBtn = document.getElementById('logout-btn');
    logoutBtn.addEventListener('click', () => {
      localStorage.removeItem('uiLanguage');
      localStorage.removeItem('session');
      window.location.href = 'login.html';
    });
  </script>
</body>
</html>